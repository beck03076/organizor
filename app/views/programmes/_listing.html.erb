<!-- setting other variables based on model passed to this partial -->
<% _model = eval(model) %>
<% model_pl = model.downcase.pluralize %>

<% _id = "all" + "_" + model_pl %>
<% url = "/institution_programmes/#{@institution_id}.json" %>
<% srch_url = send("search_" + model_pl + "_path") %>
<!-- Displaying data in the jquery datatable -->
            <div class="row">
            <div class="col-md-12 data-table">
            <div class="well">
            <% div_id = "group_assign_to_" + _id %>
            <div id="<%= div_id %>" data-model=<%= model %>></div>
            <div class="row row-top">
              <div class="col-md-2">
                <select id="mass-actions" style="width:130px" class="form-control hor-first">
                    <option>-Mass Actions-</option>
                    <!----------------------- Comm Claim Update Start---------------------------->
                    <% if can? :update, Programme %>
                      <option value="commClaimStatus">Claim Status</option>
                    <% end %>
                    <!----------------------- Group Assign End---------------------------->
                    <!----------------------- App Status Start---------------------------->
                    <% if can?  :update, Programme %>
                      <option value="appStatus">Application Status</option>
                    <% end %>
                    <!----------------------- App Status End---------------------------->
                </select>
                <!----------------------- Comm Claim Update Modal Start---------------------------->
                    <%= bulk_asso_update("Claim Status",
                                        "comm_claim_status_",
                                        'CommissionClaimStatus',
                                        '-status-',
                                        model,
                                        current_user.id,
                                        'commClaimStatusModal',
                                        'Update Status',
                                        'updateCommClaim',
                                         _id) %>
                    <div id="partial-fee"></div>
                <!----------------------- Comm Claim Update Modal End---------------------------->
                <!----------------------- App Status Modal Start---------------------------->
                     <%= bulk_asso_update("Application Status",
                                        "app_status_",
                                        'ApplicationStatus',
                                        '-status-',
                                        model,
                                        current_user.id,
                                        'appStatusModal',
                                        'Update Status',
                                        'updateAppStatus',
                                         _id) %>
                <!-----------------------App Status Modal End---------------------------->

              </div>
              <!-----------------------Search Start---------------------------->
              <div class="col-md-8 text-center filter-center">
                <form class="form-inline" role="form">
                  <div class="form-group">
                    <label for="id_column">Filter by</label>
                    <%= select_tag :abdc,
                        options_for_select((@cols - [:follow_up_date]).map{|i|
                           i.is_a?(Array) ? [i[3].to_s.titleize,i[3]]  : [i.to_s.titleize,i]
                        }.unshift(["-column name-",""])),
                        {id: "mySelect",class: "form-control hor-first"} %>
                  </div>
                  <div class="form-group">
                    <label for="id_search">containing</label>
                    <input style="width:130px" type="text" class="form-control inline-control" id="id_search" placeholder="search term">
                  </div>
                  <span class="glyphicon glyphicon-remove" onclick="resetDataTable();"></span>
                  <span class="glyphicon glyphicon-filter" onclick="$('.ransack').slideToggle();"></span>

                </form>
              </div>
             <!-----------------------Search End---------------------------->
             <!-----------------------FollowUp Filter Start---------------------------->
              <div class="col-md-2">
                <form class="form-inline" role="form">
                  <div class="form-group pull-right">
                    <span class="glyphicon mar0 glyphicon-list-alt"></span>
                    <%= link_to "xls",programmes_path,{id: "xls", 
                                                       data: {ins_id: @institution_id,
                                                              format: 'xls'}} %> |
                    <span class="glyphicon mar0 glyphicon-book"></span>
                    <%= link_to "pdf",programmes_path,{id: "pdf", 
                                                       data: {ins_id: @institution_id,
                                                              format: 'pdf'}} %>
                  </div>
                </form>
              </div>
            </div>
            <!-----------------------FollowUp Filter End---------------------------->

       <!-----------------------Ransack Filter End---------------------------->

       <% @search = _model.search(params[:q]) %>
       <% @search.build_condition if @search.conditions.empty? %>
       <% @search.build_sort if @search.sorts.empty? %>
       
       <div class="row">
         
       <div class="well blue-well ransack" style="display:none;">       
       <%= search_form_for @search, url: srch_url, method: :post, html: {remote: true,
                                                                  class: "form-horizontal",
                                                                  id: "ransack_form"} do |f| %>
              <%= render 'programmes/ransack_filter', f: f %>
              
       <% end %>
          </div>
      </div>
       <!-----------------------Ransack Filter End---------------------------->
       <!-----------------------Edit fee Start---------------------------->
         <div id="resource-edit"></div>
       <!-----------------------Edit fee End---------------------------->

<table id='<%= _id %>' cellpadding="0" cellspacing="0" border="0" class="table table-hover" data-source="<%= url %>">
<thead>
  <tr>
      <th>
      <%= check_box_tag "master",nil,false,{id: "master_check",
                                            class:"nowrap",
                                            checked: false,
                                            onclick: "toggleAllCheck(this,'#{_id}');",
                                            autocomplete: "off"} %>
      </th>

      <% @cols.each do |i| %>
        <% if i.is_a?(Array) %>
          <th><%= (i[3] || i[1]).to_s.titleize %></th>
        <% else %>
          <th <%= (i.to_s == 'statuses' ? 'class=statuses' : '') %>>
          <%= i.to_s.titleize %>
          </th>
        <% end %>
      <% end %>

      <th></th>
      <th></th>

  </tr>
</thead>

</table>

<div id="more-info"></div>

<script src="/dt-bootstrap.js"></script>
<script>

 var tab = dataTableStart("<%= _id %>","finance","<%= @cols %>",'<%= @cols.size %>');

 $('.length-element').html('<form class="form-inline" role="form"><div class="form-group">' +
                           '<select class="form-control hor-first" onchange="tabLength(tab,this);">' +
                           '<option>10</option>' +
                           '<option>20</option>' +
                           '<option>30</option>' +
                           '<option>40</option>' +
                           '<option>50</option>' +
                           '</select>'+
                           '<label for="id_column" class="label-right">rows per page</label>' +
                           '</div></form>');

 $('#mass-actions').change(function(){
   var rows = getCheckedRowsAsArray('<%= _id %>');
   var clicked = $("#mass-actions").val();
   $('#' + clicked + 'Modal').modal('show');
 });

 actmm('<%= act %>');
 acttab('<%= @status || @partial_name %>');

 
 $('#xls, #pdf').on("click",function(){

   var ins_id = $(this).data("ins-id");
   var f = $(this).data("format");
   
   var rows = getCheckedRowsAsArray('<%= _id %>',"dont_stop");
   
   if(rows.length == 0){ rows = 0 };
   url = '/programmes/ins_id/' + ins_id  + '/prog_ids/' + rows + '/export.' + f
   
   var $idown;
   if ($idown) {
        $idown.attr('src',url);
      } else {
        $idown = $('<iframe>', { id:'idown', src:url }).hide().appendTo('body');
   }

   return false;
   
 });

</script>

