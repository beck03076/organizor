<!-- setting other variables based on model passed to this partial -->
<% _model = eval(model) %>
<% model_pl = model.downcase.pluralize %>

<% _id = "all" + "_" + model_pl %>
<% url = "/institution_programmes/#{@institution_id}.json" %>
<% srch_url = send("search_" + model_pl + "_path") %>
<!-- Displaying data in the jquery datatable -->
            <div class="row">
              <div class="col-md-12 data-table">
            <div class="well">
            <% div_id = "group_assign_to_" + _id %>
            <div id="<%= div_id %>" data-model=<%= model %>></div>
            <div class="row row-top">
              <div class="col-md-2">
                <select id="mass-actions" style="width:130px" class="form-control hor-first">
                    <option>-Mass Actions-</option>
                    <!----------------------- Comm Claim Update Start---------------------------->
                    <% if can? :update, Programme %>
                      <option value="commClaimStatus">Claim Status</option>
                    <% end %>
                    <!----------------------- Group Assign End---------------------------->
                    <!----------------------- App Status Start---------------------------->
                    <% if can?  :update, Programme %>
                      <option value="appStatus">Application Status</option>
                    <% end %>
                    <!----------------------- App Status End---------------------------->
                    <!----------------------- Group Delete Start--------------------------->
                    <% if can? :destroy, _model %>
                      <option value="deactivate">Deactivate</option>
                    <% end %>
                    <!----------------------- Group Delete End--------------------------->
                </select>
                <!----------------------- Comm Claim Update Modal Start---------------------------->
                    <%= bulk_asso_update("Claim Status",
                                        "comm_claim_status_",
                                        'CommissionClaimStatus',
                                        '-status-',
                                        model,
                                        current_user.id,
                                        'commClaimStatusModal',
                                        'Update Status',
                                        'updateCommClaim',
                                         _id) %>
                <!----------------------- Comm Claim Update Modal End---------------------------->
                <!----------------------- App Status Modal Start---------------------------->
                <% ctnt = '<div class="row">
                           <div class="col-md-10">
                           <div class="col-md-offset-3">
                              <form class="form-inline" role="form">' +
                              label_tag(:user,"Application Status",{class: "col-md-3"}) +
                              select_tag("app_status_#{_id}",
                              options_for_select(ApplicationStatus.order(:name).map{|i| [i.name.titleize,i.id]}),
                              {prompt: "-status-",
                              class: "form-control hor-first col-md-4",
                              data: {model: model,
                              user_id: current_user.id}}) +
                              '</form> </div></div></div>' %>

                <%= render 'shared/modal',id: 'appStatusModal',
                           content: ctnt.html_safe,
                           header: 'Update Status',
                           button: "<button onclick=updateAppStatus('#{_id}');>Change</button>" %>
                <!-----------------------App Status Modal End---------------------------->
                <!----------------------- Group Delete Modal Start---------------------------->
                <% ctnt = 'Are you sure you want to deactivate the selected enquiries ?' %>

                <%= render 'shared/modal',id: 'deactivateModal',
                           content: ctnt.html_safe,
                           header: 'Group Delete',
                           button: "<button onclick=groupDelete('#{_id}');>Yes</button>" %>
                <!-----------------------Group Delete Modal End---------------------------->


              </div>
              <!-----------------------Search Start---------------------------->
              <div class="col-md-8 text-center filter-center">
                <form class="form-inline" role="form">
                  <div class="form-group">
                    <label for="id_column">Filter by</label>
                    <%= select_tag :abdc,
                        options_for_select((@cols - [:follow_up_date]).map{|i|
                        i.is_a?(Array) ? [i[0].to_s.titleize,i[0]]  : [i.to_s.titleize,i]
                        }.unshift(["-column name-",""])),
                        {id: "mySelect",class: "form-control hor-first"} %>
                  </div>
                  <div class="form-group">
                    <label for="id_search">containing</label>
                    <input style="width:130px" type="text" class="form-control inline-control" id="id_search" placeholder="search term">
                  </div>
                  <span class="glyphicon glyphicon-remove" onclick="resetDataTable();"></span>
                  <span class="glyphicon glyphicon-search" onclick="$('.ransack').slideToggle();"></span>

                </form>
              </div>
             <!-----------------------Search End---------------------------->
             <!-----------------------FollowUp Filter Start---------------------------->
              <div class="col-md-2">
                <form class="form-inline" role="form">
                  <div class="form-group pull-right">
                    <span class="glyphicon mar0 glyphicon-list-alt"></span>
                    <%= link_to "xls",programmes_path,{id: "xls", 
                                                       data: {ins_id: @institution_id,
                                                              format: 'xls'}} %> |
                    <span class="glyphicon mar0 glyphicon-book"></span>
                    <%= link_to "pdf",programmes_path,{id: "pdf", 
                                                       data: {ins_id: @institution_id,
                                                              format: 'pdf'}} %>
                  </div>
                </form>
              </div>
            </div>
            <!-----------------------FollowUp Filter End---------------------------->
<br/>
       <!-----------------------Ransack Filter End---------------------------->

       <% @search = _model.search(params[:q]) %>
       <% @search.build_condition if @search.conditions.empty? %>
       <% @search.build_sort if @search.sorts.empty? %>
       <div class="well well-sm filter-well ransack row" style="display:none;">
       <%= search_form_for @search, url: srch_url, method: :post, html: {remote: true,
                                                                  class: "form-inline"} do |f| %>

              <div class="row">
                  <h5 class="col-sm-2">Filter By</h5>
                    <%= f.label :institution_id_eq, "Institution" %>
                    <%= f.text_field :course_level_name_cont %>
              </div>
              <div class="field row">
                 <div class="row">
                      <h5 class="col-sm-2">Sort By</h5>
                 </div>
                  <div class="col-md-12">

                        <div class="col-sm-5">
                            <%= f.sort_fields do |s| %>
                                <%= s.sort_select({},{class: "form-control"}) %>
                            <% end %>
                          <span onclick="$(this).submit();" class="glyphicon glyphicon-search" id="ransack_submit">
                          </span>
                        </div>
                  </div>
              </div>

       <% end %>
       </div>
       <!-----------------------Ransack Filter End---------------------------->

<table id='<%= _id %>' cellpadding="0" cellspacing="0" border="0" class="table table-hover" data-source="<%= url %>">
<thead>
  <tr>
      <th>
      <%= check_box_tag "master",nil,false,{id: "master_check",
                                            class:"nowrap",
                                            checked: false,
                                            onclick: "toggleAllCheck(this,'#{_id}');",
                                            autocomplete: "off"} %>
      </th>

      <% @cols.each do |i| %>
        <% if i.is_a?(Array) %>
          <th><%= (i[3] || i[1]).to_s.titleize %></th>
        <% else %>
          <th <%= (i.to_s == 'statuses' ? 'class=statuses' : '') %>>
          <%= i.to_s.titleize %>
          </th>
        <% end %>
      <% end %>

      <th></th>
      <th></th>
      <th></th>

  </tr>
</thead>

</table>

<div id="more-info"></div>

<script src="/dt-bootstrap.js"></script>
<script>

 var tab = dataTableStart("<%= _id %>","<%= @status %>","<%= @cols %>",'<%= @cols.size %>');

 $('.length-element').html('<form class="form-inline" role="form"><div class="form-group">' +
                           '<select class="form-control hor-first" onchange="tabLength(tab,this);">' +
                           '<option>10</option>' +
                           '<option>20</option>' +
                           '<option>30</option>' +
                           '<option>40</option>' +
                           '<option>50</option>' +
                           '</select>'+
                           '<label for="id_column" class="label-right">rows per page</label>' +
                           '</div></form>');

 $('#mass-actions').change(function(){
   var rows = getCheckedRowsAsArray('<%= _id %>');
   var clicked = $("#mass-actions").val();
   $('#' + clicked + 'Modal').modal('show');
 });

 actmm('<%= act %>');
 acttab('<%= @status || @partial_name %>');

 
 $('#xls, #pdf').on("click",function(){
   var ins_id = $(this).data("ins-id");
   var f = $(this).data("format");
   
   var rows = getCheckedRowsAsArray('<%= _id %>',"dont_stop");
   
   if(rows.length == 0){ rows = 0 };
   url = '/programmes/ins_id/' + ins_id  + '/prog_ids/' + rows + '/export.' + f
   
   var $idown;
   if ($idown) {
        $idown.attr('src',url);
      } else {
        $idown = $('<iframe>', { id:'idown', src:url }).hide().appendTo('body');
   }
   return false;
   
 });
 
 


 
</script>

