<script>
$(function(){
    imagePreview("todo");
});
</script>

<% if @list.to_i == 1 && obj.todos.size > 0 %>
<table class="tables2" border="0" cellpadding="0" cellspacing="0" width="100%">
     <thead>
      <tr>
                            <th>Topic</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Due Date</th>
                            <th>Priority</th>
                            <th>Assigned To</th>
                            <th>Assigned By</th>
      </tr>
    </thead>
    <tbody>
            <% obj.todos.each do |t| %>
                <tr  class="preview" data-todo_id='<%= t.id %>'>
                    <td><%= t.topic.try(:name) %></td>
                    <td><%= t.desc %></td>
                    <td><%= t.status.try(:name) %></td>
                    <td><%= t.duedate %></td>
                    <td><%= t.priority %></td>
                    <td><%= t.ato %></td>
                    <td><%= t.aby %></td>
               </tr>
           <% end %> 
<tr>
                    <td colspan="7" align="left"><a href="#">Back</a></td>
               </tr>           

    </tbody>
  </table>
<br/>
<br/>
<% end %>
<div class="htab">
<h6><b>New Todo</b></h6>
</div>
<br/>

<div id="followup-action" class="action-box">
<%= form_for(@todo) do |g| %>

  <%= g.hidden_field obj_id.to_sym, value: id %>
                 <div class="cols">
                    <div class="col6">
                        <%= hidden_field_tag "#{g.object_name}[sub_id]",obj.id %>
                        <%= hidden_field_tag "#{g.object_name}[sub_class]",obj_name.capitalize %>
                        <%= go_create(g,"todo_topic","topic_id","name",1,"fbox") %> 
                        <%= go_create(g,"todo_status","status_id","name",1,"fbox") %> 
                        <%= fbox(g,[:assigned_to, 
                                 User.order(:first_name), 
                                 :id, 
                                 :first_name,
                                 {:prompt => "--User--"}],"collection_select",1,"Assign To") %>
                        
                        <%= fbox(g,[:duedate,:class => "dateTimeField caltf "],"text_field",nil) %>
                        <div class="fbox">
                        <label>Priority</label>
                        <%= g.select(:priority,
                                     options_for_select(["High","Medium","Low"])) %>
                        </div> 
                        <%= fbox(g,[:desc,:size => "2x2",:style => "height:auto"],"text_area",nil,"Description") %>
                        
                        <%= g.hidden_field :assigned_by, :value => current_user.id.to_s %>
                    </div>
                </div>
    <%= hidden_field_tag "#{g.object_name}[todo]", "from_action" %>
    <%= g.submit "Create",{:class => "btnp fl"} %>
    <div class="cl"></div>
<% end %>
</div>
