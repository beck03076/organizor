<?xml version="1.0" encoding="UTF-8"?>
<?mso-application progid="Excel.Sheet"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:c="urn:schemas-microsoft-com:office:component:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x2="http://schemas.microsoft.com/office/excel/2003/xml" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<OfficeDocumentSettings xmlns="urn:schemas-microsoft-com:office:office">
<Colors>
<Color>
<Index>3</Index>
<RGB>#c0c0c0</RGB>
</Color>
<Color><Index>4</Index><RGB>#ff0000</RGB></Color>
</Colors>
</OfficeDocumentSettings>
<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">
</ExcelWorkbook>
<Styles>
<Style ss:ID="Default" ss:Name="Default"/>
<Style ss:ID="Result" ss:Name="Result">
<Font ss:Bold="1" ss:Italic="1" ss:Underline="Single"/>
</Style>
<Style ss:ID="Result2" ss:Name="Result2">
<Font ss:Bold="1" ss:Italic="1" ss:Underline="Single"/>
<NumberFormat ss:Format="Currency"/>
</Style>
<Style ss:ID="Heading" ss:Name="Heading">
<Font ss:Bold="1" ss:Italic="1" ss:Size="16"/></Style>
<Style ss:ID="Heading1" ss:Name="Heading1">
<Font ss:Bold="1" ss:Italic="1" ss:Size="16"/>
</Style>
<Style ss:ID="co1"/>
<Style ss:ID="co2"/>
<Style ss:ID="co3"/>
<Style ss:ID="co4"/>
<Style ss:ID="co5"/>
<Style ss:ID="co6"/>
<Style ss:ID="co7"/>


<Style ss:ID="1">
  <Font ss:Bold="1" ss:Size="11" ss:Color="#ffffff"/>
  <Interior ss:Color="#008cba" ss:Pattern="Solid"/>
</Style>
<Style ss:ID="2">
  <Font ss:Bold="1" ss:Size="11"/>
  <Alignment ss:Vertical="Top"/> 
</Style>
<Style ss:ID="3">
  <Alignment ss:Vertical="Top"/> 
</Style>
<Style ss:ID="bo">
  <Font ss:Bold="1" ss:Size="11"/>
</Style>
<Style ss:ID="ce6">
<Alignment ss:Vertical="Top" ss:WrapText="1"/>
</Style>
<Style ss:ID="red">
  <Font ss:Bold="1" ss:Color="#a40000"/>
  <Alignment ss:Vertical="Top"/> 
</Style>

<Style ss:ID="ins">
  <Font ss:Bold="1" ss:Size="15" ss:Color="#ffffff"/>
  <Interior ss:Color="#004156" ss:Pattern="Solid"/>
  <Alignment ss:Vertical="Top"/> 
</Style>

</Styles>

<ss:Worksheet ss:Name="List Of Institutions">

<Table>
<ss:Column ss:Width="50"/>
<ss:Column ss:Width="220"/>
<ss:Column ss:Width="110"/>
<ss:Column ss:Width="110"/>
<ss:Column ss:Width="110"/>
<ss:Column ss:Width="110"/>
<ss:Column ss:Width="110"/>
<ss:Column ss:Width="300"/>


<Row ss:Height="25" ss:StyleID="ins">
  <Cell><Data ss:Type="String">List of <%= @records.size %> <%= @model.to_s.titleize.pluralize %></Data></Cell>
</Row>
<Row ss:Index="3" ss:Height="14.5134" ss:StyleID="1">
<Cell><Data ss:Type="String">S.No.</Data></Cell>
<Cell><Data ss:Type="String">Name</Data></Cell>
<Cell><Data ss:Type="String">Type</Data></Cell>
<Cell><Data ss:Type="String">Allowed Regions</Data></Cell>
<Cell><Data ss:Type="String">Allowed Countries</Data></Cell>
<Cell><Data ss:Type="String">Prohibited Regions</Data></Cell>
<Cell><Data ss:Type="String">Prohibited Countries</Data></Cell>
<Cell><Data ss:Type="String">Sliding Scales</Data></Cell>


</Row>
<% @records.each_with_index do |ins,i| %>
  <!-- Assuming only one contract for an institution for now-->
  <% c = ins.contracts.first %>
  <% if !c.nil? %>
      <Row ss:Height="50">
        <Cell ss:StyleID="3"><Data ss:Type="String"><%= i + 1 %></Data></Cell>
        <Cell ss:StyleID="2"><Data ss:Type="String"><%= ins.name rescue nil %></Data></Cell>
        <Cell ss:StyleID="2"><Data ss:Type="String"><%= ins.type_name %></Data></Cell>
        <Cell ss:StyleID="ce6"><Data ss:Type="String"><%= (c.all_permitted_regions.map &:name).join(",")  %></Data></Cell>
        <Cell ss:StyleID="ce6"><Data ss:Type="String"><%= (c.all_permitted_countries.map &:name).join(",") %></Data></Cell>
        <Cell ss:StyleID="ce6"><Data ss:Type="String"><%= (c.all_prohibited_regions.map &:name).join(",")  %></Data></Cell>
        <Cell ss:StyleID="ce6"><Data ss:Type="String"><%= (c.all_prohibited_countries.map &:name).join(",")  %></Data></Cell>      
        <Cell ss:StyleID="3"><Data ss:Type="String">
           <% c.sliding_scales.each do |ss| %>
              <% clev =  ss.course_level_name.join(", ") %>                
                  <%= clev.blank? ? "All Course Levels" : clev %>
                    2nd Year - <%= ss.second_year.blank? ? 0 : ss.second_year %>%
                    3rd Year - <%= ss.third_year.blank? ? 0 : ss.third_year %>%
                  <% ss.sliding_ranges.each do |sr| %>
                      <% if (sr.from.nil? && sr.to.nil?) %>
                        <% text = "to all students" %>
                      <% elsif (sr.from.nil? && !sr.to.nil?) %>
                        <% text = "#{sr.to}+ students" %>
                      <% else %>
                        <% text = nil %>
                      <% end %>
                      <% if !text.nil? %>
                    <%= sr.commission_percentage %> % <%= text %>
                      <% else %>
                    <%= sr.from %> - <%= sr.to %> = <%= sr.commission_percentage %> % 
                      <% end %>
                  <% end %>
            <% end %>
      </Data></Cell>     
      </Row>
  <% else %>
    <Row ss:Height="50">
        <Cell ss:StyleID="3"><Data ss:Type="String"><%= i + 1 %></Data></Cell>
        <Cell ss:StyleID="red"><Data ss:Type="String"><%= ins.name rescue nil %> (No Contract Created!)</Data></Cell>
    </Row>
  <% end %>
<% end %>

</Table>
<x:WorksheetOptions/>
</ss:Worksheet>
</Workbook>
