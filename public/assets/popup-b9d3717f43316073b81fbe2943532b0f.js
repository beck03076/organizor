!function(o){o.fn.bPopup=function(t,n){function e(){f.modal&&o('<div class="b-modal '+h+'"></div>').css({backgroundColor:f.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:f.zIndex+I}).appendTo(f.appendTo).fadeTo(f.speed,f.opacity),r(),P.data("bPopup",f).data("id",h).css({left:"slideIn"===f.transition?-1*(k+T):s(!(!f.follow[0]&&g||m)),position:f.positionStyle||"absolute",top:"slideDown"===f.transition?-1*(C+T):c(!(!f.follow[1]&&b||m)),"z-index":f.zIndex+I+1}).each(function(){f.appending&&o(this).appendTo(f.appendTo)}),l(!0)}function i(){return f.modal&&o(".b-modal."+P.data("id")).fadeTo(f.speed,0,function(){o(this).remove()}),f.scrollBar||o("html").css("overflow","auto"),o(".b-modal."+h).unbind("click"),x.unbind("keydown."+h),_.unbind("."+h).data("bPopup",0<_.data("bPopup")-1?_.data("bPopup")-1:null),P.undelegate(".bClose, ."+f.closeClass,"click."+h,i).data("bPopup",null),l(),!1}function a(o){var t=o.width(),n=o.height(),e={};f.contentContainer.css({height:n,width:t}),n>=P.height()&&(e.height=P.height()),t>=P.width()&&(e.width=P.width()),y=P.outerHeight(!0),T=P.outerWidth(!0),r(),f.contentContainer.css({height:"auto",width:"auto"}),e.left=s(!(!f.follow[0]&&g||m)),e.top=c(!(!f.follow[1]&&b||m)),P.animate(e,250,function(){o.show(),w=p()})}function l(o){switch(f.transition){case"slideIn":P.css({display:"block",opacity:1}).animate({left:o?s(!(!f.follow[0]&&g||m)):x.scrollLeft()-(T||P.outerWidth(!0))-200},f.speed,f.easing,function(){d(o)});break;case"slideDown":P.css({display:"block",opacity:1}).animate({top:o?c(!(!f.follow[1]&&b||m)):x.scrollTop()-(y||P.outerHeight(!0))-200},f.speed,f.easing,function(){d(o)});break;default:P.stop().fadeTo(f.speed,o?1:0,function(){d(o)})}}function d(t){t?(_.data("bPopup",I),P.delegate(".bClose, ."+f.closeClass,"click."+h,i),f.modalClose&&o(".b-modal."+h).css("cursor","pointer").bind("click",i),!H&&(f.follow[0]||f.follow[1])&&_.bind("scroll."+h,function(){w&&P.dequeue().animate({left:f.follow[0]?s(!m):"auto",top:f.follow[1]?c(!m):"auto"},f.followSpeed,f.followEasing)}).bind("resize."+h,function(){(w=p())&&(clearTimeout(v),v=setTimeout(function(){r(),P.dequeue().each(function(){m?o(this).css({left:k,top:C}):o(this).animate({left:f.follow[0]?s(!0):"auto",top:f.follow[1]?c(!0):"auto"},f.followSpeed,f.followEasing)})},50))}),f.escClose&&x.bind("keydown."+h,function(o){27==o.which&&i()}),u(n)):(P.hide(),u(f.onClose),f.loadUrl&&(f.contentContainer.empty(),P.css({height:"auto",width:"auto"})))}function s(o){return o?k+x.scrollLeft():k}function c(o){return o?C+x.scrollTop():C}function u(t){o.isFunction(t)&&t.call(P)}function r(){var o;b?o=f.position[1]:(o=((window.innerHeight||_.height())-P.outerHeight(!0))/2-f.amsl,o=W>o?W:o),C=o,k=g?f.position[0]:((window.innerWidth||_.width())-P.outerWidth(!0))/2,w=p()}function p(){return(window.innerHeight||_.height())>P.outerHeight(!0)+W&&(window.innerWidth||_.width())>P.outerWidth(!0)+W}o.isFunction(t)&&(n=t,t=null);var f=o.extend({},o.fn.bPopup.defaults,t);f.scrollBar||o("html").css("overflow","hidden");var h,w,b,g,m,C,k,y,T,v,P=this,x=o(document),_=o(window),H=/OS 6(_\d)+/i.test(navigator.userAgent),W=20,I=0;return P.close=function(){f=this.data("bPopup"),h="__b-popup"+_.data("bPopup")+"__",i()},P.each(function(){if(!o(this).data("bPopup"))if(u(f.onOpen),I=(_.data("bPopup")||0)+1,h="__b-popup"+I+"__",b="auto"!==f.position[1],g="auto"!==f.position[0],m="fixed"===f.positionStyle,y=P.outerHeight(!0),T=P.outerWidth(!0),f.loadUrl)switch(f.contentContainer=o(f.contentContainer||P),f.content){case"iframe":var t=o('<iframe class="b-iframe" scrolling="no" frameborder="0"></iframe>');t.appendTo(f.contentContainer),y=P.outerHeight(!0),T=P.outerWidth(!0),e(),t.attr("src",f.loadUrl),u(f.loadCallback);break;case"image":e(),o("<img />").load(function(){u(f.loadCallback),a(o(this))}).attr("src",f.loadUrl).hide().appendTo(f.contentContainer);break;default:e(),o('<div class="b-ajax-wrapper"></div>').load(f.loadUrl,f.loadData,function(){u(f.loadCallback),a(o(this))}).hide().appendTo(f.contentContainer)}else e()})},o.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",zIndex:9997}}(jQuery);