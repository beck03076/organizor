/**
 * @summary     FixedColumns
 * @description Freeze columns in place on a scrolling DataTable
 * @file        FixedColumns.js
 * @version     2.0.4.dev
 * @author      Allan Jardine (www.sprymedia.co.uk)
 * @license     GPL v2 or BSD 3 point style
 * @contact     www.sprymedia.co.uk/contact
 *
 * @copyright Copyright 2010-2011 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license, available at:
 *   http://datatables.net/license_gpl2
 *   http://datatables.net/license_bsd
 */
var FixedColumns;!function(t,e){FixedColumns=function(e,i){return!this instanceof FixedColumns?(alert("FixedColumns warning: FixedColumns must be initialised with the 'new' keyword."),void 0):("undefined"==typeof i&&(i={}),this.s={dt:e.fnSettings(),iTableColumns:e.fnSettings().aoColumns.length,aiOuterWidths:[],aiInnerWidths:[],bOldIE:t.browser.msie&&("6.0"==t.browser.version||"7.0"==t.browser.version)},this.dom={scroller:null,header:null,body:null,footer:null,grid:{wrapper:null,dt:null,left:{wrapper:null,head:null,body:null,foot:null},right:{wrapper:null,head:null,body:null,foot:null}},clone:{left:{header:null,body:null,footer:null},right:{header:null,body:null,footer:null}}},this.s.dt.oFixedColumns=this,this._fnConstruct(i),void 0)},FixedColumns.prototype={fnUpdate:function(){this._fnDraw(!0)},fnRedrawLayout:function(){this._fnGridLayout()},fnRecalculateHeight:function(t){t._DTTC_iHeight=null,t.style.height="auto"},fnSetRowHeight:function(e,i){var s=t(e).children(":first"),o=s.outerHeight()-s.height();t.browser.mozilla||t.browser.opera?e.style.height=i+"px":t(e).children().height(i-o)},_fnConstruct:function(i){var s,o,d=this;if("function"!=typeof this.s.dt.oInstance.fnVersionCheck||this.s.dt.oInstance.fnVersionCheck("1.8.0")!==!0)return alert("FixedColumns "+FixedColumns.VERSION+" required DataTables 1.8.0 or later. "+"Please upgrade your DataTables installation"),void 0;if(""===this.s.dt.oScroll.sX)return this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"FixedColumns is not needed (no x-scrolling in DataTables enabled), so no action will be taken. Use 'FixedHeader' for column fixing when scrolling is not enabled"),void 0;this.s=t.extend(!0,this.s,FixedColumns.defaults,i),this.dom.grid.dt=t(this.s.dt.nTable).parents("div.dataTables_scroll")[0],this.dom.scroller=t("div.dataTables_scrollBody",this.dom.grid.dt)[0];var h=t(this.dom.grid.dt).width(),l=0,n=0;for(t("tbody>tr:eq(0)>td, tbody>tr:eq(0)>th",this.s.dt.nTable).each(function(e){d.s.aiInnerWidths.push(t(this).width()),o=t(this).outerWidth(),d.s.aiOuterWidths.push(o),e<d.s.iLeftColumns&&(l+=o),d.s.iTableColumns-d.s.iRightColumns<=e&&(n+=o)}),null===this.s.iLeftWidth&&(this.s.iLeftWidth="fixed"==this.s.sLeftWidth?l:100*(l/h)),null===this.s.iRightWidth&&(this.s.iRightWidth="fixed"==this.s.sRightWidth?n:100*(n/h)),this._fnGridSetup(),s=0;s<this.s.iLeftColumns;s++)this.s.dt.oInstance.fnSetColumnVis(s,!1);for(s=this.s.iTableColumns-this.s.iRightColumns;s<this.s.iTableColumns;s++)this.s.dt.oInstance.fnSetColumnVis(s,!1);t(this.dom.scroller).scroll(function(){d.dom.grid.left.body.scrollTop=d.dom.scroller.scrollTop,d.s.iRightColumns>0&&(d.dom.grid.right.body.scrollTop=d.dom.scroller.scrollTop)}),t(e).resize(function(){d._fnGridLayout.call(d)});var r=!0;this.s.dt.aoDrawCallback=[{fn:function(){d._fnDraw.call(d,r),d._fnGridHeight(d),r=!1},sName:"FixedColumns"}].concat(this.s.dt.aoDrawCallback),this._fnGridLayout(),this._fnGridHeight(),this.s.dt.oInstance.fnDraw(!1)},_fnGridSetup:function(){this.dom.body=this.s.dt.nTable,this.dom.header=this.s.dt.nTHead.parentNode,this.dom.header.parentNode.parentNode.style.position="relative";var e=t('<div class="DTFC_ScrollWrapper" style="position:relative; clear:both;"><div class="DTFC_LeftWrapper" style="position:absolute; top:0; left:0;"><div class="DTFC_LeftHeadWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_LeftBodyWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_LeftFootWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div></div><div class="DTFC_RightWrapper" style="position:absolute; top:0; left:0;"><div class="DTFC_RightHeadWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_RightBodyWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_RightFootWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div></div></div>')[0];nLeft=e.childNodes[0],nRight=e.childNodes[1],this.dom.grid.wrapper=e,this.dom.grid.left.wrapper=nLeft,this.dom.grid.left.head=nLeft.childNodes[0],this.dom.grid.left.body=nLeft.childNodes[1],this.s.iRightColumns>0&&(this.dom.grid.right.wrapper=nRight,this.dom.grid.right.head=nRight.childNodes[0],this.dom.grid.right.body=nRight.childNodes[1]),this.s.dt.nTFoot&&(this.dom.footer=this.s.dt.nTFoot.parentNode,this.dom.grid.left.foot=nLeft.childNodes[2],this.s.iRightColumns>0&&(this.dom.grid.right.foot=nRight.childNodes[2])),e.appendChild(nLeft),this.dom.grid.dt.parentNode.insertBefore(e,this.dom.grid.dt),e.appendChild(this.dom.grid.dt),this.dom.grid.dt.style.position="absolute",this.dom.grid.dt.style.top="0px",this.dom.grid.dt.style.left=this.s.iLeftWidth+"px",this.dom.grid.dt.style.width=t(this.dom.grid.dt).width()-this.s.iLeftWidth-this.s.iRightWidth+"px"},_fnGridLayout:function(){var e=this.dom.grid,i=t(e.wrapper).width(),s=0,o=0,d=0;s="fixed"==this.s.sLeftWidth?this.s.iLeftWidth:this.s.iLeftWidth/100*i,o="fixed"==this.s.sRightWidth?this.s.iRightWidth:this.s.iRightWidth/100*i,d=i-s-o,e.left.wrapper.style.width=s+"px",e.dt.style.width=d+"px",e.dt.style.left=s+"px",this.s.iRightColumns>0&&(e.right.wrapper.style.width=o+"px",e.right.wrapper.style.left=i-o+"px")},_fnGridHeight:function(){var e=this.dom.grid,i=t(this.dom.grid.dt).height();e.wrapper.style.height=i+"px",e.left.body.style.height=t(this.dom.scroller).height()+"px",e.left.wrapper.style.height=i+"px",this.s.iRightColumns>0&&(e.right.wrapper.style.height=i+"px",e.right.body.style.height=t(this.dom.scroller).height()+"px")},_fnDraw:function(e){this._fnCloneLeft(e),this._fnCloneRight(e),null!==this.s.fnDrawCallback&&this.s.fnDrawCallback.call(this,this.dom.clone.left,this.dom.clone.right),t(this).trigger("draw",{leftClone:this.dom.clone.left,rightClone:this.dom.clone.right})},_fnCloneRight:function(t){if(!(this.s.iRightColumns<=0)){var e,i=[];for(e=this.s.iTableColumns-this.s.iRightColumns;e<this.s.iTableColumns;e++)i.push(e);this._fnClone(this.dom.clone.right,this.dom.grid.right,i,t)}},_fnCloneLeft:function(t){if(!(this.s.iLeftColumns<=0)){var e,i=[];for(e=0;e<this.s.iLeftColumns;e++)i.push(e);this._fnClone(this.dom.clone.left,this.dom.grid.left,i,t)}},_fnCopyLayout:function(e,i){for(var s=[],o=[],d=[],h=0,l=e.length;l>h;h++){var n=[];n.nTr=t(e[h].nTr).clone(!0)[0];for(var r=0,a=this.s.iTableColumns;a>r;r++)if(-1!==t.inArray(r,i)){var f=t.inArray(e[h][r].cell,d);if(-1===f){var u=t(e[h][r].cell).clone(!0)[0];o.push(u),d.push(e[h][r].cell),n.push({cell:u,unique:e[h][r].unique})}else n.push({cell:o[f],unique:e[h][r].unique})}s.push(n)}return s},_fnClone:function(e,i,s,o){var d,h,l,n,r,a,f,u=this;if(o){null!==e.header&&e.header.parentNode.removeChild(e.header),e.header=t(this.dom.header).clone(!0)[0],e.header.className+=" DTFC_Cloned",e.header.style.width="100%",i.head.appendChild(e.header);var p=this._fnCopyLayout(this.s.dt.aoHeader,s),c=t(">thead",e.header);for(c.empty(),d=0,h=p.length;h>d;d++)c[0].appendChild(p[d].nTr);this.s.dt.oApi._fnDrawHead(this.s.dt,p,!0)}else{var p=this._fnCopyLayout(this.s.dt.aoHeader,s),g=[];for(this.s.dt.oApi._fnDetectHeader(g,t(">thead",e.header)[0]),d=0,h=p.length;h>d;d++)for(l=0,n=p[d].length;n>l;l++)g[d][l].cell.className=p[d][l].cell.className,t("span.DataTables_sort_icon",g[d][l].cell).each(function(){this.className=t("span.DataTables_sort_icon",p[d][l].cell)[0].className})}this._fnEqualiseHeights("thead",this.dom.header,e.header),"auto"==this.s.sHeightMatch&&t(">tbody>tr",u.dom.body).css("height","auto"),null!==e.body&&(e.body.parentNode.removeChild(e.body),e.body=null),e.body=t(this.dom.body).clone(!0)[0],e.body.className+=" DTFC_Cloned",e.body.style.paddingBottom=this.s.dt.oScroll.iBarWidth+"px",e.body.style.marginBottom=2*this.s.dt.oScroll.iBarWidth+"px",null!==e.body.getAttribute("id")&&e.body.removeAttribute("id"),t(">thead>tr",e.body).empty(),t(">tfoot",e.body).remove();var m=t("tbody",e.body)[0];if(t(m).empty(),this.s.dt.aiDisplay.length>0){var y=t(">thead>tr",e.body)[0];for(f=0;f<s.length;f++)r=s[f],a=t(this.s.dt.aoColumns[r].nTh).clone(!0)[0],a.innerHTML="",oStyle=a.style,oStyle.paddingTop="0",oStyle.paddingBottom="0",oStyle.borderTopWidth="0",oStyle.borderBottomWidth="0",oStyle.height=0,oStyle.width=u.s.aiInnerWidths[r]+"px",y.appendChild(a);t(">tbody>tr",u.dom.body).each(function(e){var i=this.cloneNode(!1),o=u.s.dt.oFeatures.bServerSide===!1?u.s.dt.aiDisplay[u.s.dt._iDisplayStart+e]:e;for(f=0;f<s.length;f++)r=s[f],"undefined"!=typeof u.s.dt.aoData[o]._anHidden[r]&&(a=t(u.s.dt.aoData[o]._anHidden[r]).clone(!0)[0],i.appendChild(a));m.appendChild(i)})}else t(">tbody>tr",u.dom.body).each(function(){a=this.cloneNode(!0),a.className+=" DTFC_NoData",t("td",a).html(""),m.appendChild(a)});if(e.body.style.width="100%",i.body.appendChild(e.body),this._fnEqualiseHeights("tbody",u.dom.body,e.body),null!==this.s.dt.nTFoot){if(o){null!==e.footer&&e.footer.parentNode.removeChild(e.footer),e.footer=t(this.dom.footer).clone(!0)[0],e.footer.className+=" DTFC_Cloned",e.footer.style.width="100%",i.foot.appendChild(e.footer);var p=this._fnCopyLayout(this.s.dt.aoFooter,s),C=t(">tfoot",e.footer);for(C.empty(),d=0,h=p.length;h>d;d++)C[0].appendChild(p[d].nTr);this.s.dt.oApi._fnDrawHead(this.s.dt,p,!0)}else{var p=this._fnCopyLayout(this.s.dt.aoFooter,s),b=[];for(this.s.dt.oApi._fnDetectHeader(b,t(">tfoot",e.footer)[0]),d=0,h=p.length;h>d;d++)for(l=0,n=p[d].length;n>l;l++)b[d][l].cell.className=p[d][l].cell.className}this._fnEqualiseHeights("tfoot",this.dom.footer,e.footer)}var v=this.s.dt.oApi._fnGetUniqueThs(this.s.dt,t(">thead",e.header)[0]);t(v).each(function(t){r=s[t],this.style.width=u.s.aiInnerWidths[r]+"px"}),null!==u.s.dt.nTFoot&&(v=this.s.dt.oApi._fnGetUniqueThs(this.s.dt,t(">tfoot",e.footer)[0]),t(v).each(function(t){r=s[t],this.style.width=u.s.aiInnerWidths[r]+"px"}))},_fnGetTrNodes:function(t){for(var e=[],i=0,s=t.childNodes.length;s>i;i++)"TR"==t.childNodes[i].nodeName.toUpperCase()&&e.push(t.childNodes[i]);return e},_fnEqualiseHeights:function(e,i,s){if("none"!=this.s.sHeightMatch||"thead"===e||"tfoot"===e){var o,d,h,l,n,r=i.getElementsByTagName(e)[0],a=s.getElementsByTagName(e)[0],f=t(">"+e+">tr:eq(0)",i).children(":first"),u=f.outerHeight()-f.height(),p=this._fnGetTrNodes(r),c=this._fnGetTrNodes(a);for(o=0,d=c.length;d>o;o++)"semiauto"!=this.s.sHeightMatch||"undefined"==typeof p[o]._DTTC_iHeight||null===p[o]._DTTC_iHeight?(l=p[o].offsetHeight,n=c[o].offsetHeight,h=n>l?n:l,"semiauto"==this.s.sHeightMatch&&(p[o]._DTTC_iHeight=h),t.browser.msie&&t.browser.version<8?(t(c[o]).children().height(h-u),t(p[o]).children().height(h-u)):(c[o].style.height=h+"px",p[o].style.height=h+"px")):t.browser.msie&&t(c[o]).children().height(p[o]._DTTC_iHeight-u)}}},FixedColumns.defaults={iLeftColumns:1,iRightColumns:0,fnDrawCallback:null,sLeftWidth:"fixed",iLeftWidth:null,sRightWidth:"fixed",iRightWidth:null,sHeightMatch:"semiauto"},FixedColumns.prototype.CLASS="FixedColumns",FixedColumns.VERSION="2.0.4.dev"}(jQuery,window,document);